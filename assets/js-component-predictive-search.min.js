(()=>{"use strict";class t extends HTMLElement{#t;#e="[[value]]";#s={undefined:"undefined",available:"available",not_available:"not-available",does_not_exist:"does-not-exist"};#i="js-product-option-";dataAttributes={};optionName;$productSection;constructor(t){super(),this.#t=t,this.dataAttributes={name:`data-${t}-name`,valueLabel:`data-${t}-value`,classPrefix:`data-${t}-class-prefix`}}connectedCallbackStart(){if(this.optionName=this.getAttribute(this.dataAttributes.name),void 0===this.optionName||""===this.optionName)throw new Error(`[${this.#t}] [Product option name is not set]`);if(this.$productSection=this.closest("product-section"),!this.$productSection)throw new Error(`[${this.#t}] [A related product-section element is not found]`);this.#i=this.getAttribute(this.dataAttributes.classPrefix)||this.#i}connectedCallbackEnd(){this.$productSection.addEventListener("statechange",(()=>{this.render()})),this.$productSection.state&&this.render()}getOptionState(){return this.$productSection.state.optionsValues.find((t=>t.name===this.optionName))}#r(t){const e=this.$productSection.state.optionsAvailability[this.optionName];let s=this.#s.undefined;return e&&(t in e?e[t]?this.#s.available:this.#s.not_available:this.#s.does_not_exist),s}addAvailabilityClass(t,e){t.classList.remove(...Object.values(this.#s).map((t=>this.#i+t))),t.classList.add(this.#i+this.#r(e))}render(){const t=this.getOptionState();if(t){const e=t.value;this.querySelectorAll(`[${this.dataAttributes.valueLabel}]`).forEach((t=>{if(!e)return void(t.innerHTML="");const s=t.getAttribute(this.dataAttributes.valueLabel)||this.#e;t.innerHTML=s.replaceAll(this.#e,e)}))}}}class e extends HTMLElement{constructor(){super(),this.input=this.querySelector("input[type='search']"),this.resetButton=this.querySelector("button[type='reset']"),this.input&&(this.input.form.addEventListener("reset",this.onFormReset.bind(this)),this.input.addEventListener("input",function(t,e){let s;return(...i)=>{clearTimeout(s),s=setTimeout((()=>t.apply(this,i)),e)}}((t=>{this.onChange(t)}),300).bind(this)))}toggleResetButton(){const t=this.resetButton.classList.contains("hidden");this.input.value.length>0&&t?this.resetButton.classList.remove("hidden"):0!==this.input.value.length||t||this.resetButton.classList.add("hidden")}onChange(){this.toggleResetButton()}shouldResetForm(){return!document.querySelector("[aria-selected='true'] a")}onFormReset(t){t.preventDefault(),this.shouldResetForm()&&(this.input.value="",this.input.focus(),this.toggleResetButton())}}customElements.define("search-form",e);const s="predictive-search";customElements.define("predictive-search",class extends e{constructor(){super(),this.cachedResults={},this.isOpen=!1,this.searchTerm="",this.allInstances=document.querySelectorAll("predictive-search"),this.results=this.querySelector("[data-predictive-search]"),this.abortController=new AbortController,this.setEventListeners()}setEventListeners(){this.input.form.addEventListener("submit",this.onFormSubmit.bind(this)),this.input.addEventListener("focus",this.onFocus.bind(this)),this.addEventListener("focusout",this.onFocusOut.bind(this)),this.addEventListener("keyup",this.onKeyup.bind(this)),this.addEventListener("keydown",this.onKeydown.bind(this))}getQuery(){return this.input.value.trim()}onChange(){super.onChange();const t=this.getQuery();this.searchTerm=t,this.searchTerm.length?this.getSearchResults(this.searchTerm):this.close(!0)}onFormSubmit(t){this.getQuery().length&&!this.querySelector("[aria-selected='true'] a")||t.preventDefault()}onFormReset(t){super.onFormReset(t),super.shouldResetForm()&&(this.searchTerm="",this.abortController.abort(),this.abortController=new AbortController,this.closeResults(!0))}onFocus(){const t=this.getQuery();t.length&&(this.searchTerm!==t?this.onChange():"true"===this.getAttribute("results")?this.open():this.getSearchResults(this.searchTerm))}onFocusOut(){setTimeout((()=>{this.contains(document.activeElement)||this.close()}))}onKeyup(t){switch(this.getQuery().length||this.close(!0),t.preventDefault(),t.code){case"ArrowUp":this.switchOption("up");break;case"ArrowDown":this.switchOption("down");break;case"Enter":this.selectOption()}}onKeydown(t){"ArrowUp"!==t.code&&"ArrowDown"!==t.code||t.preventDefault()}switchOption(t){if(!this.getAttribute("open"))return;const e="up"===t,s=this.querySelector("[aria-selected='true']"),i=Array.from(this.querySelectorAll("[data-predictive-search-item]")).filter((t=>null!==t.offsetParent));let r=0;if(e&&!s)return;let n=-1,a=0;for(;-1===n&&a<=i.length;)i[a]===s&&(n=a),a++;if(!e&&s?r=n===i.length-1?0:n+1:e&&(r=0===n?i.length-1:n-1),r===n)return;const o=i[r];o.setAttribute("aria-selected",!0),s&&s.setAttribute("aria-selected",!1),this.input.setAttribute("aria-activedescendant",o.id)}selectOption(){const t=this.querySelector("[aria-selected='true'] a");t&&t.click()}getSearchResults(t){const e=t.replace(" ","-").toLowerCase();this.setAttribute("loading",!0),this.cachedResults[e]?this.renderSearchResults(this.cachedResults[e]):fetch(`${window.routes.predictive_search_url}?q=${encodeURIComponent(t)}&section_id=${s}`,{signal:this.abortController.signal}).then((t=>{if(!t.ok){let e=new Error(t.status);throw this.close(),e}return t.text()})).then((t=>{const i=(new DOMParser).parseFromString(t,"text/html").querySelector(`#shopify-section-${s}`).innerHTML;this.allInstances.forEach((t=>{t.cachedResults[e]=i})),this.renderSearchResults(i)})).catch((t=>{if(20!==t?.code)throw this.close(),t}))}renderSearchResults(t){this.results.innerHTML=t,this.setAttribute("results",!0),this.removeAttribute("loading"),this.open()}open(){this.setAttribute("open",!0),this.input.setAttribute("aria-expanded",!0),this.isOpen=!0}close(t=!1){this.closeResults(t),this.isOpen=!1}closeResults(t=!1){t&&(this.input.value="",this.removeAttribute("results"));const e=this.querySelector("[aria-selected='true']");e&&e.setAttribute("aria-selected",!1),this.input.setAttribute("aria-activedescendant",""),this.removeAttribute("loading"),this.removeAttribute("open"),this.input.setAttribute("aria-expanded",!1),this.results.removeAttribute("style")}})})();