(()=>{"use strict";const t="facets-form",e={ajaxInput:"data-facets-form-input",content:"data-facets-form-content",link:"data-facets-form-link"};let n,o=[],r=window.location.search.slice(1),c=window.location.search.slice(1);function s(t,r=!0){try{n&&(n.abort(),n=void 0),c=t;const s={};document.querySelectorAll(`[${e.content}]`).forEach((t=>{const[n]=(t=>{const e="shopify-section-",n=t.closest('[id^="shopify-section-"]');return n?[n.id.replace(e,""),n]:[null,null]})(t);if(!n)throw new Error(`[facets-form] [The "${e.content}" element must be within a Shopify section]`);s[n]=!0}));const f=Object.keys(s);if(f.length>5)throw new Error(`[facets-form] [The "${e.content}" elements exist in more than 5 sections]`);const u=`${window.location.pathname}?sections=${f.join(",")}&${t}`,h=o.find((t=>t.url===u));h?l(h.html):(n=new AbortController,i(!0),a(!0),fetch(u,{signal:n.signal}).then((t=>t.json())).then((t=>{let e="";for(let n in t)e+=t[n];o.push({url:u,html:e}),l(e)})).catch((e=>{"AbortError"!==e.name&&(console.error("[facets-form] [Section API request error]",e),window.location.href=`?${t}`)})).finally((()=>{a(!1),i(!1)}))),r&&history.pushState({searchParams:t},"",`${window.location.pathname}${t&&"?".concat(t)}`)}catch(e){console.error(e),window.location.href=`?${t}`}}function a(t){document.querySelectorAll(`[${e.ajaxInput}][type="number"], [${e.ajaxInput}][type="number"]`).forEach((e=>{e.readOnly=t}))}function i(t){((t,e,n)=>{t.querySelectorAll(`[${e}]`).forEach((t=>{const o=t.getAttribute(e);o&&(n?t.classList.add(o):t.classList.remove(o))}))})(document,e.loadingClass,t)}function l(t){const n=(new DOMParser).parseFromString(t,"text/html");document.querySelectorAll(`[${e.content}]`).forEach((t=>{const o=t.getAttribute(e.content);o||console.error(`[facets-form] [A "${e.content}" element doesn't have unique value]`);const r=n.querySelector(`[${e.content}="${o}"]`);r?t.innerHTML=r.innerHTML:console.error(`[facets-form] [A "${e.content}" element with "${o}" value isn't found in the section API response]`)}))}window.addEventListener("popstate",(t=>{const e=t.state?t.state.searchParams:r;e!==c&&s(e,!1)})),document.addEventListener("click",(t=>{const n=t.target.closest(`[${e.link}]`);if(!n)return;const o=n.href;o&&(s(new URL(o).searchParams.toString()),t.preventDefault())}));class f extends HTMLElement{connectedCallback(){const t=this.querySelector("form");if(!t)throw new Error('[facets-form] [The "form" element isn\'t found]');document.body.addEventListener("change",(n=>{if(n.target.form===t&&n.target.hasAttribute(e.ajaxInput)){const e=new FormData(t);s(new URLSearchParams(e).toString())}}))}}customElements.define(t,f)})();