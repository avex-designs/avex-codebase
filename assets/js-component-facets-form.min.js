(()=>{"use strict";HTMLElement;const t="facets-form",e={ajaxInput:"data-facets-form-input",content:"data-facets-form-content",link:"data-facets-form-link"};let n,o=[],r=window.location.search.slice(1),s=window.location.search.slice(1);function a(t,r=!0){try{n&&(n.abort(),n=void 0),s=t;const a={};document.querySelectorAll(`[${e.content}]`).forEach((t=>{const[n]=(t=>{const e="shopify-section-",n=t.closest('[id^="shopify-section-"]');return n?[n.id.replace(e,""),n]:[null,null]})(t);if(!n)throw new Error(`[facets-form] [The "${e.content}" element must be within a Shopify section]`);a[n]=!0}));const f=Object.keys(a);if(f.length>5)throw new Error(`[facets-form] [The "${e.content}" elements exist in more than 5 sections]`);const m=`${window.location.pathname}?sections=${f.join(",")}&${t}`,h=o.find((t=>t.url===m));h?l(h.html):(n=new AbortController,i(!0),c(!0),fetch(m,{signal:n.signal}).then((t=>t.json())).then((t=>{let e="";for(let n in t)e+=t[n];o.push({url:m,html:e}),l(e)})).catch((e=>{"AbortError"!==e.name&&(console.error("[facets-form] [Section API request error]",e),window.location.href=`?${t}`)})).finally((()=>{c(!1),i(!1)}))),r&&history.pushState({searchParams:t},"",`${window.location.pathname}${t&&"?".concat(t)}`)}catch(e){console.error(e),window.location.href=`?${t}`}}function c(t){document.querySelectorAll(`[${e.ajaxInput}][type="number"], [${e.ajaxInput}][type="text"]`).forEach((e=>{e.readOnly=t}))}function i(t){((t,e,n)=>{t.querySelectorAll(`[${e}]`).forEach((t=>{const o=t.getAttribute(e);o&&(n?t.classList.add(o):t.classList.remove(o))}))})(document,e.loadingClass,t)}function l(t){const n=(new DOMParser).parseFromString(t,"text/html");document.querySelectorAll(`[${e.content}]`).forEach((t=>{const o=t.getAttribute(e.content);if(!o)throw new Error(`[facets-form] [A "${e.content}" element doesn't have unique value]`);const r=n.querySelector(`[${e.content}="${o}"]`);if(!r)throw new Error(`[facets-form] [A "${e.content}" element with "${o}" value isn't found in the section API response]`);t.innerHTML=r.innerHTML}))}window.addEventListener("popstate",(t=>{const e=t.state?t.state.searchParams:r;e!==s&&a(e,!1)})),document.addEventListener("click",(t=>{const n=t.target.closest(`[${e.link}]`);if(!n)return;const o=n.href;o&&(a(new URL(o).searchParams.toString()),t.preventDefault())}));class f extends HTMLElement{#$form;connectedCallback(){if(this.#$form=this.querySelector("form"),!this.#$form)throw new Error('[facets-form] [The "form" element isn\'t found]');this.#$form.addEventListener("submit",(t=>{t.preventDefault(),this.#ajaxSubmit()})),document.body.addEventListener("change",(t=>{t.target.form===this.#$form&&t.target.hasAttribute(e.ajaxInput)&&this.#ajaxSubmit()}))}#ajaxSubmit(){const t=new FormData(this.#$form);a(new URLSearchParams(t).toString())}}customElements.define(t,f)})();