(()=>{"use strict";const t=(t,e,n)=>{t.querySelectorAll(`[${e}]`).forEach((t=>{const o=t.getAttribute(e);o&&(n?t.classList.add(o):t.classList.remove(o))}))};const e="facets-form",n={ajaxInput:`data-${e}-input`,content:`data-${e}-content`,link:`data-${e}-link`};let o,r=[],a=window.location.search.slice(1),s=window.location.search.slice(1);function c(t,a=!0){try{o&&(o.abort(),o=void 0),s=t;const c={};document.querySelectorAll(`[${n.content}]`).forEach((t=>{const[o]=(t=>{const e="shopify-section-",n=t.closest(`[id^="${e}"]`);return n?[n.id.replace(e,""),n]:[null,null]})(t);if(!o)throw new Error(`[${e}] [The "${n.content}" element must be within a Shopify section]`);c[o]=!0}));const u=Object.keys(c);if(u.length>5)throw new Error(`[${e}] [The "${n.content}" elements exist in more than 5 sections]`);const m=`${window.location.pathname}?sections=${u.join(",")}&${t}`,d=r.find((t=>t.url===m));d?h(d.html):(o=new AbortController,l(!0),i(!0),fetch(m,{signal:o.signal}).then((t=>t.json())).then((t=>{let e="";for(let n in t)e+=t[n];r.push({url:m,html:e}),h(e)})).catch((n=>{"AbortError"!==n.name&&(console.error(`[${e}] [Section API request error]`,n),window.location.href=`?${t}`)})).finally((()=>{i(!1),l(!1)}))),a&&history.pushState({searchParams:t},"",`${window.location.pathname}${t&&"?".concat(t)}`)}catch(e){console.error(e),window.location.href=`?${t}`}}function i(t){document.querySelectorAll(`[${n.ajaxInput}][type="number"], [${n.ajaxInput}][type="text"]`).forEach((e=>{e.readOnly=t}))}function l(e){t(document,n.loadingClass,e)}function h(t){const o=(new DOMParser).parseFromString(t,"text/html");document.querySelectorAll(`[${n.content}]`).forEach((t=>{const r=t.getAttribute(n.content);if(!r)throw new Error(`[${e}] [A "${n.content}" element doesn't have unique value]`);const a=o.querySelector(`[${n.content}="${r}"]`);if(!a)throw new Error(`[${e}] [A "${n.content}" element with "${r}" value isn't found in the section API response]`);t.innerHTML=a.innerHTML}))}window.addEventListener("popstate",(t=>{const e=t.state?t.state.searchParams:a;e!==s&&c(e,!1)})),document.addEventListener("click",(t=>{const e=t.target.closest(`[${n.link}]`);if(!e)return;const o=e.href;o&&(c(new URL(o).searchParams.toString()),t.preventDefault())}));class u extends HTMLElement{_$form;connectedCallback(){if(this._$form=this.querySelector("form"),!this._$form)throw new Error(`[${e}] [The "form" element isn't found]`);this._$form.addEventListener("submit",(t=>{t.preventDefault(),this._ajaxSubmit()})),document.body.addEventListener("change",(t=>{t.target.form===this._$form&&t.target.hasAttribute(n.ajaxInput)&&this._ajaxSubmit()}))}_ajaxSubmit(){const t=new FormData(this._$form);c(new URLSearchParams(t).toString())}}customElements.define(e,u)})();