(()=>{"use strict";class e extends HTMLElement{constructor(){super(),this.resetActiveFilter=this.resetActiveFilter.bind(this),this.debouncedOnSubmit=function(e,t){let r;return(...n)=>{clearTimeout(r),r=setTimeout((()=>e.apply(this,n)),t)}}((e=>{this.onSubmitHandler(e)}),500),this.querySelector("form").addEventListener("input",this.debouncedOnSubmit.bind(this))}static setListeners(){window.addEventListener("popstate",(t=>{const r=t.state?t.state.searchParams:e.searchParamsInitial;r!==e.searchParamsPrev&&e.renderPage(r,null,!1)}))}static updateURLHash(e){history.pushState({searchParams:e},"",`${window.location.pathname}${e&&"?".concat(e)}`)}static renderProductGridContainer(e){document.getElementById("ProductsList").innerHTML=(new DOMParser).parseFromString(e,"text/html").getElementById("ProductsList").innerHTML}static renderFilters(e){(new DOMParser).parseFromString(e,"text/html").querySelectorAll("#FiltersForm .js-filter").forEach((e=>{document.querySelector(`.js-filter[data-index="${e.dataset.index}"]`).innerHTML=e.innerHTML}))}static renderSectionFromFetch(t,r){fetch(t).then((e=>e.text())).then((n=>{const a=n;e.renderProductGridContainer(a),e.data=[...e.data,{html:a,url:t}],e.renderFilters(a,r),e.renderProductCount(a)}))}static renderSectionFromCache(t,r){const n=e.data.find(t).html;e.renderFilters(n,r),e.renderProductGridContainer(n),e.renderProductCount(n)}static renderProductCount(e){const t=(new DOMParser).parseFromString(e,"text/html").getElementById("ProductsCount").innerHTML;document.getElementById("ProductsCount").innerHTML=t}static renderPage(t,r,n=!0){e.searchParamsPrev=t;const a=document.getElementById("ProductsList").dataset.id;document.getElementById("ProductsList").querySelector("[data-products-list]").classList.add("loading");const s=`${window.location.pathname}?section_id=${a}&${t}`,i=e=>e.url===s;e.data.some(i)?e.renderSectionFromCache(i,r):e.renderSectionFromFetch(s,r),n&&e.updateURLHash(t)}onSubmitHandler(t){t.preventDefault();const r=new FormData(t.target.closest("form")),n=new URLSearchParams(r).toString();e.renderPage(n,t)}resetActiveFilter(t){t.preventDefault(),e.renderPage(new URL(t.currentTarget.href).searchParams.toString())}}e.data=[],e.searchParamsInitial=window.location.search.slice(1),e.searchParamsPrev=window.location.search.slice(1),customElements.define("filter-and-sort-form",e),e.setListeners()})();